<html>
<head><title>blah</title>
    
<script src="http://d3js.org/d3.v3.min.js" charset="utf-8"></script>
<script src="http://code.jquery.com/jquery-1.10.2.min.js" charset="utf-8"></script>
<script src="http://underscorejs.org/underscore-min.js" charset="utf-8"></script>

</head>
<body>
  <div id="game-info">
    <p id="player-score"></p>
    <p id="high-score"></p>
  </div>
  <svg width="600px" height="400px">
    <circle id="player" cx='100px' cy='100px' r='10px' fill="yellow" stroke="orange" stroke-width="5px" />
  </svg>
    
</body>
<script>
$(document).ready(function() {

  var stats = {
    playerScore: 0,
    highScore: 0
  };

  var $playerScore = $('#player-score');
  var $highScore = $('#high-score');

  var gameBoard = d3.select('svg');
  var player = d3.select('#player');

  var incrementScore = function() {
    stats.playerScore++;
    if (stats.playerScore >= stats.highScore) {
      stats.highScore = stats.playerScore;
    }
    $playerScore.text("Player Score: " + stats.playerScore);
    $highScore.text("High Score: " + stats.highScore);
  };

  var resetPlayerScore = function() {
    stats.playerScore = 0;
    $playerScore.text("Player Score: " + stats.playerScore);
  };

  var enemyMaker = function() {
    var enemy = {};
    enemy.posX = undefined;
    enemy.posY = undefined;
    enemy.setNewPosition = function() {
      this.posX = Math.floor(Math.random() * 560) + 20;
      this.posY = Math.floor(Math.random() * 360) + 20;
    }
    enemy.setNewPosition();
    return enemy;
  };

  var createEnemies = function(amount) {
    var enemies = [];
    for (var i = 0; i < amount; i++) {
      enemies.push(enemyMaker());
    }
    return enemies;
  };

  var updateEnemyPositions = function(enemies) {
    _.each(enemies, function(enemy) {
      enemy.setNewPosition();
    });
    return enemies;
  };

  var update = function(data) {
    var enemies = gameBoard.selectAll('circle.enemy').data(data);

    enemies.enter().append('circle')
      .attr("class", "enemy")
      .attr("cx", function(d) { return d.posX + "px" })
      .attr("cy", function(d) { return d.posY + "px" })
      .attr("r", "15px")
      .attr("fill", "red");

    enemies.transition()
      .duration(1000)
      .attrTween("cx", function(d, i, a) {
        a = parseInt(a);
        return d3.interpolate(a, d.posX) ;
      })
      .attrTween("cy", function(d, i, a) {
        a = parseInt(a);
        return d3.interpolate(a, d.posY) ;
      }); 
  };

  var enemies = createEnemies(30);

  update(enemies);

  setInterval(function() {
    enemies = updateEnemyPositions(enemies);
    update(enemies);
  }, 1000);

  setInterval(function() {
    incrementScore();
  }, 50);

  d3.selectAll('.enemy').on('mouseover', function(obj) {
    resetPlayerScore();
  });

  var dragPlayer = d3.behavior.drag()
    .on("drag", function(d) {
      player
        .attr("cx", d3.event.x + "px")
        .attr("cy", d3.event.y + "px");
    });

  player.call(dragPlayer);



});
</script>
</html>